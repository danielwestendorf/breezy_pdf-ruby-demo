(function(r){r.plot.plugins.push({init:function(n){function F(a){for(var c=0,b=0,h=0,g=d.series.pie.combine.color,k=[],m=0;m<a.length;++m){var f=a[m].data;r.isArray(f)&&1==f.length&&(f=f[0]);r.isArray(f)?!isNaN(parseFloat(f[1]))&&isFinite(f[1])?f[1]=+f[1]:f[1]=0:f=!isNaN(parseFloat(f))&&isFinite(f)?[1,+f]:[1,0];a[m].data=[f]}for(m=0;m<a.length;++m)c+=a[m].data[0][1];for(m=0;m<a.length;++m)f=a[m].data[0][1],f/c<=d.series.pie.combine.threshold&&(b+=f,h++,g||(g=a[m].color));for(m=0;m<a.length;++m)f=
a[m].data[0][1],(2>h||f/c>d.series.pie.combine.threshold)&&k.push(r.extend(a[m],{data:[[1,f]],color:a[m].color,label:a[m].label,angle:f*Math.PI*2/c,percent:f/(c/100)}));1<h&&k.push({data:[[1,b]],color:g,label:d.series.pie.combine.label,angle:b*Math.PI*2/c,percent:b/(c/100)});return k}function G(a,c){function l(){b.clearRect(0,0,k,m);w.children().filter(".pieLabel, .pieLabelBackground").remove()}function h(){var a=d.series.pie.shadow.left,c=d.series.pie.shadow.top,f=d.series.pie.shadow.alpha,l=1<d.series.pie.radius?
d.series.pie.radius:t*d.series.pie.radius;if(!(l>=k/2-a||l*d.series.pie.tilt>=m/2-c||10>=l)){b.save();b.translate(a,c);b.globalAlpha=f;b.fillStyle="#000";b.translate(q,y);b.scale(1,d.series.pie.tilt);for(a=1;10>=a;a++)b.beginPath(),b.arc(0,0,l,0,2*Math.PI,!1),b.fill(),l-=a;b.restore()}}function g(){function a(a,c,d){0>=a||isNaN(a)||(d?b.fillStyle=c:(b.strokeStyle=c,b.lineJoin="round"),b.beginPath(),1E-9<Math.abs(a-2*Math.PI)&&b.moveTo(0,0),b.arc(0,0,l,g,g+a/2,!1),b.arc(0,0,l,g+a/2,g+a,!1),b.closePath(),
g+=a,d?b.fill():b.stroke())}function c(){for(var a=f,c=1<d.series.pie.label.radius?d.series.pie.label.radius:t*d.series.pie.label.radius,b=0;b<p.length;++b){if(p[b].percent>=100*d.series.pie.label.threshold){var l=p[b];var g=a,e=b;if(0==l.data[0][1])l=!0;else{var h=d.legend.labelFormatter;var n=d.series.pie.label.formatter;h=h?h(l.label,l):l.label;n&&(h=n(h,l));n=(g+l.angle+g)/2;g=q+Math.round(Math.cos(n)*c);n=y+Math.round(Math.sin(n)*c)*d.series.pie.tilt;w.append("<span class='pieLabel' id='pieLabel"+
e+"' style='position:absolute;top:"+n+"px;left:"+g+"px;'>"+h+"</span>");e=w.children("#pieLabel"+e);h=n-e.height()/2;n=g-e.width()/2;e.css("top",h);e.css("left",n);0<0-h||0<0-n||0>m-(h+e.height())||0>k-(n+e.width())?l=!1:(0!=d.series.pie.label.background.opacity&&(g=d.series.pie.label.background.color,null==g&&(g=l.color),l="top:"+h+"px;left:"+n+"px;",r("<div class='pieLabelBackground' style='position:absolute;width:"+e.width()+"px;height:"+e.height()+"px;"+l+"background-color:"+g+";'></div>").css("opacity",
d.series.pie.label.background.opacity).insertBefore(e)),l=!0)}if(!l)return!1}a+=p[b].angle}return!0}var f=Math.PI*d.series.pie.startAngle,l=1<d.series.pie.radius?d.series.pie.radius:t*d.series.pie.radius;b.save();b.translate(q,y);b.scale(1,d.series.pie.tilt);b.save();for(var g=f,h=0;h<p.length;++h)p[h].startAngle=g,a(p[h].angle,p[h].color,!0);b.restore();if(0<d.series.pie.stroke.width){b.save();b.lineWidth=d.series.pie.stroke.width;g=f;for(h=0;h<p.length;++h)a(p[h].angle,d.series.pie.stroke.color,
!1);b.restore()}B(b);b.restore();return d.series.pie.label.show?c():!0}if(w){var k=a.getPlaceholder().width(),m=a.getPlaceholder().height(),f=w.children().filter(".legend").children().width()||0;b=c;A=!1;t=Math.min(k,m/d.series.pie.tilt)/2;y=m/2+d.series.pie.offset.top;q=k/2;"auto"==d.series.pie.offset.left?(q=d.legend.position.match("w")?q+f/2:q-f/2,q<t?q=t:q>k-t&&(q=k-t)):q+=d.series.pie.offset.left;var p=a.getData();f=0;do 0<f&&(t*=.95),f+=1,l(),.8>=d.series.pie.tilt&&h();while(!g()&&10>f);10<=
f&&(l(),w.prepend("<div class='error'>Could not draw pie with labels contained inside canvas</div>"));a.setSeries&&a.insertLegend&&(a.setSeries(p),a.insertLegend())}}function B(a){if(0<d.series.pie.innerRadius){a.save();var c=1<d.series.pie.innerRadius?d.series.pie.innerRadius:t*d.series.pie.innerRadius;a.globalCompositeOperation="destination-out";a.beginPath();a.fillStyle=d.series.pie.stroke.color;a.arc(0,0,c,0,2*Math.PI,!1);a.fill();a.closePath();a.restore();a.save();a.beginPath();a.strokeStyle=
d.series.pie.stroke.color;a.arc(0,0,c,0,2*Math.PI,!1);a.stroke();a.closePath();a.restore()}}function H(a){C("plothover",a)}function I(a){C("plotclick",a)}function C(a,c){var l=n.offset(),h=parseInt(c.pageX-l.left);a:{l=parseInt(c.pageY-l.top);var g=n.getData(),k=n.getOptions();k=1<k.series.pie.radius?k.series.pie.radius:t*k.series.pie.radius;for(var m,f,p=0;p<g.length;++p){var e=g[p];if(e.pie.show){b.save();b.beginPath();b.moveTo(0,0);b.arc(0,0,k,e.startAngle,e.startAngle+e.angle/2,!1);b.arc(0,0,
k,e.startAngle+e.angle/2,e.startAngle+e.angle,!1);b.closePath();m=h-q;f=l-y;if(b.isPointInPath){if(b.isPointInPath(h-q,l-y)){b.restore();h={datapoint:[e.percent,e.data],dataIndex:0,series:e,seriesIndex:p};break a}}else{var u=[[0,0],[k*Math.cos(e.startAngle),k*Math.sin(e.startAngle)],[k*Math.cos(e.startAngle+e.angle/4),k*Math.sin(e.startAngle+e.angle/4)],[k*Math.cos(e.startAngle+e.angle/2),k*Math.sin(e.startAngle+e.angle/2)],[k*Math.cos(e.startAngle+e.angle/1.5),k*Math.sin(e.startAngle+e.angle/1.5)],
[k*Math.cos(e.startAngle+e.angle),k*Math.sin(e.startAngle+e.angle)]];m=[m,f];f=!1;for(var x=-1,r=u.length,z=r-1;++x<r;z=x)(u[x][1]<=m[1]&&m[1]<u[z][1]||u[z][1]<=m[1]&&m[1]<u[x][1])&&m[0]<(u[z][0]-u[x][0])*(m[1]-u[x][1])/(u[z][1]-u[x][1])+u[x][0]&&(f=!f);if(f){b.restore();h={datapoint:[e.percent,e.data],dataIndex:0,series:e,seriesIndex:p};break a}}b.restore()}}h=null}if(d.grid.autoHighlight)for(l=0;l<v.length;++l)g=v[l],g.auto!=a||h&&g.series==h.series||(g=g.series,null==g&&(v=[],n.triggerRedrawOverlay()),
g=D(g),-1!=g&&(v.splice(g,1),n.triggerRedrawOverlay()));h&&(l=h.series,g=D(l),-1==g?(v.push({series:l,auto:a}),n.triggerRedrawOverlay()):a||(v[g].auto=!1));w.trigger(a,[{pageX:c.pageX,pageY:c.pageY},h])}function D(a){for(var c=0;c<v.length;++c)if(v[c].series==a)return c;return-1}var E=null,w=null,d=null,t=null,q=null,y=null,A=!1,b=null,v=[];n.hooks.processOptions.push(function(a,c){c.series.pie.show&&(c.grid.show=!1,"auto"==c.series.pie.label.show&&(c.series.pie.label.show=c.legend.show?!1:!0),"auto"==
c.series.pie.radius&&(c.series.pie.radius=c.series.pie.label.show?.75:1),1<c.series.pie.tilt?c.series.pie.tilt=1:0>c.series.pie.tilt&&(c.series.pie.tilt=0))});n.hooks.bindEvents.push(function(a,c){var b=a.getOptions();b.series.pie.show&&(b.grid.hoverable&&c.unbind("mousemove").mousemove(H),b.grid.clickable&&c.unbind("click").click(I))});n.hooks.processDatapoints.push(function(a,c,b,h){a.getOptions().series.pie.show&&!A&&(A=!0,E=a.getCanvas(),w=r(E).parent(),d=a.getOptions(),a.setData(F(a.getData())))});
n.hooks.drawOverlay.push(function(a,c){if(a.getOptions().series.pie.show){var b=a.getOptions(),d=1<b.series.pie.radius?b.series.pie.radius:t*b.series.pie.radius;c.save();c.translate(q,y);c.scale(1,b.series.pie.tilt);for(var g=0;g<v.length;++g){var k=v[g].series;0>=k.angle||isNaN(k.angle)||(c.fillStyle="rgba(255, 255, 255, "+b.series.pie.highlight.opacity+")",c.beginPath(),1E-9<Math.abs(k.angle-2*Math.PI)&&c.moveTo(0,0),c.arc(0,0,d,k.startAngle,k.startAngle+k.angle/2,!1),c.arc(0,0,d,k.startAngle+k.angle/
2,k.startAngle+k.angle,!1),c.closePath(),c.fill())}B(c);c.restore()}});n.hooks.draw.push(function(a,b){a.getOptions().series.pie.show&&G(a,b)})},options:{series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,shadow:{left:5,top:15,alpha:.02},offset:{top:0,left:"auto"},stroke:{color:"#fff",width:1},label:{show:"auto",formatter:function(n,r){return"<div style='font-size:x-small;text-align:center;padding:2px;color:"+r.color+";'>"+n+"<br/>"+Math.round(r.percent)+"%</div>"},radius:1,background:{color:null,
opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:.5}}}},name:"pie",version:"1.1"})})(jQuery);